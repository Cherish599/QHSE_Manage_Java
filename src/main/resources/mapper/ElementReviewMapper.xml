<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wlhse.dao.ElementReviewDao">

    <select id="query" parameterType="com.wlhse.dto.inDto.ElementReviewDto"
            resultType="com.wlhse.dto.outDto.QHSECompanyYearManagerSysElementDto">
        select * from qhse_companyyearmanagersyselement
        <where>
            <if test="companyName != null and companyName  != ''">
                AND companyName=#{companyName}
            </if>
            <if test="year != null and year  != ''">
                AND year=#{year}
            </if>
            and qHSE_CompanyYearManagerSysElementTable_ID in
             (select qHSE_CompanyYearManagerSysElementTable_ID
            from qhse_companyyearmanagersyselementtable where checkStaffID=#{checkStaffID}) and status="未审核"
        </where>
    </select>

    <select id="queryS" parameterType="com.wlhse.dto.inDto.ElementReviewDto"
            resultType="com.wlhse.dto.outDto.QHSECompanyYearManagerSysElementDto">
        select * from qhse_companyyearmanagersyselement  <where>
        <if test="companyName != null and companyName  != ''">
            AND companyName=#{companyName}
        </if>
        <if test="year != null and year  != ''">
            AND year=#{year}
        </if>
        and qHSE_CompanyYearManagerSysElementTable_ID in
        (select qHSE_CompanyYearManagerSysElementTable_ID
        from qhse_companyyearmanagersyselementtable where approverStaffID=#{approverStaffID})and status="未批准"
    </where>
    </select>

    <update id="update" parameterType="com.wlhse.dto.inDto.ElementReviewDto">
        update qhse_companyyearmanagersyselement
        set status=#{status}
        where qHSE_CompanyYearManagerSysElement_ID=#{qHSE_CompanyYearManagerSysElement_ID}
    </update>


    <select id="queryAll" parameterType="Integer" resultType="com.wlhse.dto.outDto.QhseEvidenceAttatchDto">
        select *
         from qhse_companyyearmanagersyselementevidence t1,qhse_companyyearmanagersyselementevidenceattach t2
        where t1.QHSE_CompanyYearManagerSysElementEvidence_ID=t2.QHSE_CompanyYearManagerSysElementEvidence_ID
        and t1.QHSE_CompanyYearManagerSysElement_ID=#{id}
    </select>

</mapper>